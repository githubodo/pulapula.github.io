<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test RIA Proxy Player</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.8.6/shaka-player.compiled.js"></script>

  <style>
    body { margin: 0; background: #000; overflow: hidden; }
    #videoContainer { width: 100vw; height: 100vh; position: relative; }
    video { width: 100%; height: 100%; object-fit: contain; background: #000; }
    #watermark {
      position: absolute; bottom: 15px; right: 15px;
      color: #fff; opacity: 0.7; font-size: 14px;
      background: rgba(0,0,0,0.4); padding: 5px 10px; border-radius: 4px;
    }
  </style>
</head>

<body>
<div id="videoContainer">
  <video id="video" autoplay controls muted></video>
  <div id="watermark">TVMalaysia.live</div>
</div>

<script>
async function initPlayer() {

  shaka.polyfill.installAll();

  if (!shaka.Player.isBrowserSupported()) {
    alert("Browser tidak support Shaka Player");
    return;
  }

  const video = document.getElementById("video");
  const player = new shaka.Player(video);

  // Debug
  player.addEventListener("error", e => console.error("Shaka Error:", e.detail));

  const manifestUrl = "https://get.tvmalaysia.live/ria/index.mpd";

  // ============================================================
  // ðŸ”¥ FIX UTAMA: FORCE CLEARKEY ONLY
  // ============================================================

  player.configure({
    drm: {
      servers: {
        'org.w3.clearkey': 'https://get.tvmalaysia.live/ria/license'
      },

      // Tikam mati Widevine & PlayReady supaya Shaka tak sentuh langsung
      advanced: {
        'com.widevine.alpha': { videoRobustness: '', audioRobustness: '' },
        'com.microsoft.playready': { videoRobustness: '', audioRobustness: '' }
      },

      // Jangan auto detect DRM lain
      initDataTransform: null,
      initData: {}
    },

    // Elak Shaka auto pilih codec pelik â†’ stability improved
    preferredAudioCodecs: ['mp4a.40.5'],
    preferredVideoCodecs: ['avc1.4D4015', 'avc1.4D4029', 'avc1.640029']
  });

  // ============================================================
  // ðŸš€ LOAD STREAM
  // ============================================================

  try {
    await player.load(manifestUrl);
    console.log("RIA Stream Loaded!");
  } catch (err) {
    console.error("LOAD ERROR", err);
  }

}

document.addEventListener("DOMContentLoaded", initPlayer);
</script>

</body>
</html>